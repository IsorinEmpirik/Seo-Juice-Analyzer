{% extends "layout.html" %}

{% block title %}Fonctionnement de l'Algorithme - SEO Juice Analyzer{% endblock %}

{% block extra_head %}
<!-- Mermaid.js pour les diagrammes -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<style>
    .algo-section {
        margin-bottom: 3rem;
    }

    .algo-card {
        border: none;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        height: 100%;
    }

    .algo-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 20px rgba(0,0,0,0.12);
    }

    .formula-box {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-left: 4px solid #55C9A8;
        padding: 1.5rem;
        border-radius: 8px;
        font-family: 'Courier New', monospace;
        margin: 1rem 0;
    }

    .highlight-box {
        background: linear-gradient(135deg, #fff3cd 0%, #ffe69c 100%);
        border-left: 4px solid #ffc107;
        padding: 1rem;
        border-radius: 8px;
        margin: 1rem 0;
    }

    .step-badge {
        display: inline-block;
        width: 40px;
        height: 40px;
        background: #55C9A8;
        color: white;
        border-radius: 50%;
        text-align: center;
        line-height: 40px;
        font-weight: bold;
        font-size: 1.2rem;
        margin-right: 1rem;
    }

    .comparison-table {
        background: white;
        border-radius: 8px;
        overflow: hidden;
    }

    .comparison-table th {
        background: linear-gradient(135deg, #55C9A8 0%, #43B896 100%);
        color: white;
        font-weight: 600;
        padding: 1rem;
    }

    .comparison-table td {
        padding: 1rem;
        border-bottom: 1px solid #dee2e6;
    }

    .yes-badge {
        color: #28a745;
        font-weight: bold;
    }

    .no-badge {
        color: #dc3545;
        font-weight: bold;
    }

    .flow-diagram {
        background: white;
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    }

    code {
        background: #f8f9fa;
        padding: 0.2rem 0.4rem;
        border-radius: 4px;
        color: #d63384;
        font-size: 0.9em;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="row mb-5">
        <div class="col-12">
            <h1 class="display-4 fw-bold text-primary mb-3">
                <i class="bi bi-cpu-fill"></i> Fonctionnement de l'Algorithme
            </h1>
            <p class="lead text-muted">
                Comprendre comment notre outil calcule la distribution du "jus SEO" en s'inspirant du PageRank
            </p>
        </div>
    </div>

    <!-- Section 1: Introduction au PageRank -->
    <div class="algo-section">
        <div class="row mb-4">
            <div class="col-12">
                <h2 class="h3 fw-bold mb-3">
                    <span class="step-badge">1</span> Le PageRank de Google : La Base
                </h2>
            </div>
        </div>

        <div class="row g-4">
            <div class="col-md-6">
                <div class="card algo-card">
                    <div class="card-body">
                        <h5 class="card-title text-primary">
                            <i class="bi bi-lightbulb"></i> Le Concept Original
                        </h5>
                        <p class="card-text">
                            Le <strong>PageRank</strong> est l'algorithme historique de Google qui évalue l'importance d'une page web
                            en fonction des liens qu'elle reçoit. L'idée est simple :
                        </p>
                        <ul>
                            <li>Une page est importante si elle reçoit des liens de pages importantes</li>
                            <li>Le "jus" (ou autorité) se transmet de page en page via les liens</li>
                            <li>Chaque lien sortant divise le jus de la page source</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card algo-card">
                    <div class="card-body">
                        <h5 class="card-title text-success">
                            <i class="bi bi-diagram-3"></i> Notre Formule PageRank
                        </h5>
                        <p class="card-text mb-3">Formule adaptée avec poids de liens :</p>
                        <div class="formula-box">
                            PR(A) = (1-d) × T(A) + d × Σ(PR(B) × W(B→A) / ΣW(B))
                        </div>
                        <small class="text-muted">
                            <strong>PR(A)</strong> = PageRank de la page A<br>
                            <strong>d</strong> = damping factor (0.85)<br>
                            <strong>T(A)</strong> = probabilité téléportation (basée sur backlinks)<br>
                            <strong>W(B→A)</strong> = poids du lien B→A (contenu=9, nav=1)<br>
                            <strong>ΣW(B)</strong> = somme des poids sortants de B
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Section 2: Notre Adaptation -->
    <div class="algo-section">
        <div class="row mb-4">
            <div class="col-12">
                <h2 class="h3 fw-bold mb-3">
                    <span class="step-badge">2</span> Notre Adaptation pour le Maillage Interne
                </h2>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="highlight-box">
                    <h5 class="mb-3">
                        <i class="bi bi-star-fill text-warning"></i> Les Différences Clés
                    </h5>
                    <p class="mb-2">
                        Notre algorithme s'inspire du PageRank mais l'adapte pour analyser spécifiquement le maillage interne.
                        Voici les principales différences :
                    </p>
                </div>

                <table class="table comparison-table mt-4">
                    <thead>
                        <tr>
                            <th style="width: 30%;">Caractéristique</th>
                            <th style="width: 35%;">PageRank Original</th>
                            <th style="width: 35%;">Notre Algorithme</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Terme de téléportation</strong></td>
                            <td><span class="yes-badge">✓</span> Uniforme (1-d)/N</td>
                            <td><span class="yes-badge">✓</span> Personnalisé selon backlinks</td>
                        </tr>
                        <tr>
                            <td><strong>Rôle des backlinks</strong></td>
                            <td>Non pris en compte (externe)</td>
                            <td><span class="yes-badge">✓</span> Boost la probabilité de téléportation</td>
                        </tr>
                        <tr>
                            <td><strong>Poids des liens</strong></td>
                            <td>Tous égaux</td>
                            <td><span class="yes-badge">✓</span> Contenu (9x) > Navigation (1x)</td>
                        </tr>
                        <tr>
                            <td><strong>Damping factor</strong></td>
                            <td>d = 0.85</td>
                            <td><span class="yes-badge">✓</span> d = 0.85 (identique)</td>
                        </tr>
                        <tr>
                            <td><strong>Convergence</strong></td>
                            <td>Σ|ΔPR| < ε</td>
                            <td><span class="yes-badge">✓</span> Σ|ΔPR| < 10⁻⁶ (max 100 itérations)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Section 3: Les Composants de l'Algorithme -->
    <div class="algo-section">
        <div class="row mb-4">
            <div class="col-12">
                <h2 class="h3 fw-bold mb-3">
                    <span class="step-badge">3</span> Les Composants Clés
                </h2>
            </div>
        </div>

        <div class="row g-4">
            <!-- Backlinks -->
            <div class="col-lg-4">
                <div class="card algo-card border-success">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-link-45deg"></i> Backlinks Externes
                        </h5>
                    </div>
                    <div class="card-body">
                        <p><strong>Rôle :</strong> Boost de téléportation</p>
                        <div class="formula-box">
                            T(A) = 0.5/N + 0.5 × (BL(A) / Total_BL)
                        </div>
                        <p class="mb-0 small text-muted">
                            <i class="bi bi-info-circle"></i> Les pages avec backlinks ont plus de chances d'être
                            la destination d'un "random jump" (50% uniforme + 50% basé sur backlinks).
                        </p>
                    </div>
                </div>
            </div>

            <!-- Poids des liens -->
            <div class="col-lg-4">
                <div class="card algo-card border-primary">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-award"></i> Poids des Liens
                        </h5>
                    </div>
                    <div class="card-body">
                        <p><strong>Système de pondération :</strong></p>
                        <ul class="mb-3">
                            <li><strong>Liens de contenu :</strong> Poids = 9</li>
                            <li><strong>Liens de navigation :</strong> Poids = 1</li>
                        </ul>
                        <p class="mb-0 small text-muted">
                            <i class="bi bi-info-circle"></i> Un lien dans le contenu transmet <strong>9 fois plus</strong> de jus
                            qu'un lien dans la navigation (menu, footer).
                        </p>
                    </div>
                </div>
            </div>

            <!-- Damping -->
            <div class="col-lg-4">
                <div class="card algo-card border-warning">
                    <div class="card-header bg-warning">
                        <h5 class="mb-0">
                            <i class="bi bi-droplet-half"></i> Damping Factor
                        </h5>
                    </div>
                    <div class="card-body">
                        <p><strong>d = 0.85</strong> (standard Google)</p>
                        <div class="formula-box">
                            15% → téléportation (random jump)<br>
                            85% → suivi des liens
                        </div>
                        <p class="mb-0 small text-muted">
                            <i class="bi bi-info-circle"></i> À chaque étape, l'utilisateur a 15% de chances de "téléporter"
                            vers une page aléatoire (pondérée par backlinks) et 85% de suivre un lien.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Section 4: Le Processus Étape par Étape -->
    <div class="algo-section">
        <div class="row mb-4">
            <div class="col-12">
                <h2 class="h3 fw-bold mb-3">
                    <span class="step-badge">4</span> Le Processus de Calcul
                </h2>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="flow-diagram">
                    <h5 class="text-center mb-4">Algorithme PageRank Itératif</h5>
                    <div class="mermaid">
graph TD
    A[Initialisation PR = T] --> B[Pour chaque page A]
    B --> C["PR(A) = (1-d) × T(A)"]
    C --> D["+ d × Σ(PR(B) × fraction(B→A))"]
    D --> E{Toutes les pages traitées ?}
    E -->|Non| B
    E -->|Oui| F["Calculer erreur = Σ|nouveau - ancien|"]
    F --> G{Erreur < 10⁻⁶ ?}
    G -->|Oui| H[Convergence atteinte]
    G -->|Non| I{Iteration < 100 ?}
    I -->|Oui| B
    I -->|Non| H

    style A fill:#28a745,color:#fff
    style C fill:#ffc107
    style D fill:#55C9A8,color:#fff
    style H fill:#dc3545,color:#fff
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-12">
                <div class="card algo-card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">Calcul de la Fraction Transmise</h5>
                    </div>
                    <div class="card-body">
                        <p class="mb-3">Quand une page B lie vers une page A :</p>

                        <div class="formula-box">
                            <strong>Étape 1 :</strong> Calculer le poids total sortant de B<br>
                            <code>ΣW(B) = (Nb_liens_contenu × 9) + (Nb_liens_nav × 1)</code><br><br>

                            <strong>Étape 2 :</strong> Fraction transmise par le lien B→A<br>
                            <code>fraction(B→A) = W(B→A) / ΣW(B)</code><br><br>

                            <strong>Étape 3 :</strong> Contribution au PageRank de A<br>
                            <code>Contribution = PR(B) × fraction(B→A)</code>
                        </div>

                        <p class="mt-3 mb-0 small text-muted">
                            <i class="bi bi-info-circle"></i> Un lien de contenu (poids 9) transmet 9× plus de PageRank qu'un lien de navigation (poids 1).
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Section 5: Exemple Concret -->
    <div class="algo-section">
        <div class="row mb-4">
            <div class="col-12">
                <h2 class="h3 fw-bold mb-3">
                    <span class="step-badge">5</span> Exemple Concret
                </h2>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="card algo-card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-calculator"></i> Calcul PageRank pour un site de 100 pages
                        </h5>
                    </div>
                    <div class="card-body">
                        <h6 class="text-primary mb-3">Situation :</h6>
                        <ul>
                            <li>Site de <strong>N = 100 pages</strong></li>
                            <li>Homepage reçoit <strong>60 backlinks</strong> sur un total de 80</li>
                            <li>Homepage a <strong>5 liens contenu</strong> + <strong>10 liens nav</strong></li>
                            <li>Page A reçoit un lien contenu depuis la homepage</li>
                        </ul>

                        <h6 class="text-success mt-4 mb-3">Calcul de la téléportation :</h6>
                        <div class="formula-box">
                            <strong>Téléportation Homepage :</strong><br>
                            T(HP) = 0.5/100 + 0.5 × (60/80) = 0.005 + 0.375 = <strong>0.38</strong><br><br>

                            <strong>Téléportation Page sans backlink :</strong><br>
                            T(A) = 0.5/100 + 0.5 × (0/80) = 0.005 + 0 = <strong>0.005</strong>
                        </div>

                        <h6 class="text-info mt-4 mb-3">Fraction transmise par la homepage :</h6>
                        <div class="formula-box">
                            <strong>Poids total sortant :</strong><br>
                            ΣW(HP) = (5 × 9) + (10 × 1) = 45 + 10 = <strong>55</strong><br><br>

                            <strong>Fraction vers un lien contenu :</strong><br>
                            fraction = 9 / 55 = <strong>0.164</strong> (16.4%)<br><br>

                            <strong>Fraction vers un lien nav :</strong><br>
                            fraction = 1 / 55 = <strong>0.018</strong> (1.8%)
                        </div>

                        <div class="highlight-box mt-3">
                            <strong><i class="bi bi-lightbulb"></i> Résultat :</strong><br>
                            Un lien de <strong>contenu</strong> transmet 9× plus de PageRank qu'un lien de <strong>navigation</strong> !
                            Après convergence, la homepage aura le PageRank le plus élevé grâce à ses backlinks.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Section 6: Convergence -->
    <div class="algo-section">
        <div class="row mb-4">
            <div class="col-12">
                <h2 class="h3 fw-bold mb-3">
                    <span class="step-badge">6</span> La Convergence
                </h2>
            </div>
        </div>

        <div class="row g-4">
            <div class="col-md-6">
                <div class="card algo-card">
                    <div class="card-body">
                        <h5 class="card-title text-primary">
                            <i class="bi bi-bullseye"></i> Qu'est-ce que la convergence ?
                        </h5>
                        <p>
                            L'algorithme s'arrête quand les PageRank deviennent <strong>stables</strong>, c'est-à-dire
                            quand la somme des changements devient négligeable.
                        </p>
                        <div class="formula-box">
                            Convergence si :<br>
                            Σ|PR_nouveau - PR_ancien| < 10⁻⁶
                        </div>
                        <p class="mb-0 text-muted small">
                            Maximum 100 itérations pour éviter les calculs infinis.
                        </p>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card algo-card">
                    <div class="card-body">
                        <h5 class="card-title text-success">
                            <i class="bi bi-graph-up"></i> Propriétés du PageRank
                        </h5>
                        <p>Caractéristiques importantes :</p>
                        <ul>
                            <li><strong>Somme = 1 :</strong> ΣPR(toutes pages) ≈ 1.0</li>
                            <li><strong>Valeurs typiques :</strong> Entre 0.001 et 0.1</li>
                            <li><strong>Convergence :</strong> Généralement 20-50 itérations</li>
                        </ul>
                        <p class="mb-0 text-muted small">
                            <i class="bi bi-check-circle-fill text-success"></i> La normalisation finale ramène les scores sur 0-100 pour plus de lisibilité.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Section 7: Normalisation -->
    <div class="algo-section">
        <div class="row mb-4">
            <div class="col-12">
                <h2 class="h3 fw-bold mb-3">
                    <span class="step-badge">7</span> Normalisation des Scores
                </h2>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="card algo-card">
                    <div class="card-body">
                        <p>
                            Une fois les scores stabilisés, ils sont <strong>normalisés sur une échelle de 0 à 100</strong>
                            pour faciliter leur interprétation.
                        </p>
                        <div class="formula-box">
                            Score_final = (Score_brut / Score_max) × 100
                        </div>
                        <div class="row mt-4">
                            <div class="col-md-4 text-center">
                                <div class="p-3 bg-danger text-white rounded">
                                    <h4 class="mb-0">0-20</h4>
                                    <small>Très faible</small>
                                </div>
                            </div>
                            <div class="col-md-4 text-center">
                                <div class="p-3 bg-warning rounded">
                                    <h4 class="mb-0">20-60</h4>
                                    <small>Moyen</small>
                                </div>
                            </div>
                            <div class="col-md-4 text-center">
                                <div class="p-3 bg-success text-white rounded">
                                    <h4 class="mb-0">60-100</h4>
                                    <small>Excellent</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CTA -->
    <div class="row mt-5">
        <div class="col-12 text-center">
            <div class="card algo-card border-primary">
                <div class="card-body p-4">
                    <h4 class="mb-3">Prêt à analyser votre site ?</h4>
                    <p class="text-muted mb-4">
                        Maintenant que vous comprenez l'algorithme, lancez une analyse pour découvrir
                        comment le jus SEO est distribué sur votre site.
                    </p>
                    <a href="/" class="btn btn-primary btn-lg">
                        <i class="bi bi-play-circle"></i> Lancer une Analyse
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Initialiser Mermaid
    mermaid.initialize({
        startOnLoad: true,
        theme: 'default',
        flowchart: {
            useMaxWidth: true,
            htmlLabels: true,
            curve: 'basis'
        }
    });
</script>
{% endblock %}
